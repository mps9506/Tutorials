<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Loading and Formatting Data | Practical R Applications in Water Resources</title>
  <meta name="description" content="This is a DRAFT!!!" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Loading and Formatting Data | Practical R Applications in Water Resources" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a DRAFT!!!" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Loading and Formatting Data | Practical R Applications in Water Resources" />
  
  <meta name="twitter:description" content="This is a DRAFT!!!" />
  

<meta name="author" content="Michael Schramm" />


<meta name="date" content="2020-09-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="summarize-and-visualize-data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical Intro to R and Applications in Water Resources</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#install-r"><i class="fa fa-check"></i>Install R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#install-rstudio"><i class="fa fa-check"></i>Install RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#basics"><i class="fa fa-check"></i>Familiarity with R and RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#suggested-packages"><i class="fa fa-check"></i>Suggested Packages</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributions-and-editing"><i class="fa fa-check"></i>Contributions and Editing</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1</b> Loading and Formatting Data</a><ul>
<li class="chapter" data-level="1.1" data-path="data.html"><a href="data.html#rectangular-data"><i class="fa fa-check"></i><b>1.1</b> Rectangular data</a></li>
<li class="chapter" data-level="1.2" data-path="data.html"><a href="data.html#formatting-data"><i class="fa fa-check"></i><b>1.2</b> Formatting Data</a></li>
<li class="chapter" data-level="1.3" data-path="data.html"><a href="data.html#fed-data"><i class="fa fa-check"></i><b>1.3</b> USGS and EPA Data</a></li>
<li class="chapter" data-level="1.4" data-path="data.html"><a href="data.html#online-data-sources"><i class="fa fa-check"></i><b>1.4</b> Online Data Sources</a></li>
<li class="chapter" data-level="1.5" data-path="data.html"><a href="data.html#project-workflows"><i class="fa fa-check"></i><b>1.5</b> Project Workflows</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="summarize-and-visualize-data.html"><a href="summarize-and-visualize-data.html"><i class="fa fa-check"></i><b>2</b> Summarize and Visualize Data</a></li>
<li class="chapter" data-level="3" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>3</b> Methods</a></li>
<li class="chapter" data-level="4" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>4</b> Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>4.1</b> Example one</a></li>
<li class="chapter" data-level="4.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>4.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>5</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/mps9506/Tutorials" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R Applications in Water Resources</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Loading and Formatting Data</h1>
<p>Load required packages:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data.html#cb5-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p>Text files (csv, delimited, )
Excel
Relational databases
Stat software (SAS SPSS Stata)
Spatial (shapefiles, raster, etc)</p>
<p>Reading data into R is generally the first step in any project workflow. The easiest format to get data into R is from a <code>.csv</code> or similar text file. However, there are functions to read data from Excel, relational databases, and some proprietary statistical software packages. There are also functions for readining in spatial data such as shapefiles or raster files, this is covered in …</p>
<div id="rectangular-data" class="section level2">
<h2><span class="header-section-number">1.1</span> Rectangular data</h2>
<p>Rectangular data generally refers to data stored as a table, rows and columns, or matrix. This is probably the most typical format of data we are reading into R. This data most often comes by way of text files or Excel spreadsheets. The <code>readr</code> package includes several functions for handling text files:</p>
<ul>
<li><code>read_csv</code>: reads comma separated files,</li>
<li><code>read_tsv</code>: reads tab seperated files,</li>
<li><code>read_delim</code>: reads any formatted text file with a specified field separator.</li>
</ul>
<p>The example below is reading in a TCEQ SWQMIS generated datafile. The fields in the file are pipe seperated (<code>|</code>). Notice you are not limited to local filenames, you can point to files with a valid URL address. By default, <code>readr</code> tries to guess the variable type for each column. It is tedious, but I suggest specifying the column type with the <code>col_type</code> argument to prevent any errors. You can also skip importing certain columns if you choose. This can help speed things up if you are reading in a really large dataset.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data.html#cb6-1"></a>df &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="dt">file =</span> <span class="st">&quot;https://gist.githubusercontent.com/mps9506/004624b5aa9bdf101c36278835cb38df/raw/46267d403bb450da4f7a0c726bd77d4fff1c5be5/1501_Bacteria.txt&quot;</span>,</span>
<span id="cb6-2"><a href="data.html#cb6-2"></a>                 <span class="dt">delim =</span> <span class="st">&quot;|&quot;</span>,</span>
<span id="cb6-3"><a href="data.html#cb6-3"></a>                 <span class="dt">col_types =</span> <span class="kw">cols</span>(</span>
<span id="cb6-4"><a href="data.html#cb6-4"></a>                   <span class="st">`</span><span class="dt">RFA(Sample Set ID)/Tag_id</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-5"><a href="data.html#cb6-5"></a>                   <span class="dt">Segment =</span> <span class="kw">col_character</span>(),</span>
<span id="cb6-6"><a href="data.html#cb6-6"></a>                   <span class="st">`</span><span class="dt">Station ID</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-7"><a href="data.html#cb6-7"></a>                   <span class="st">`</span><span class="dt">Station Description</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-8"><a href="data.html#cb6-8"></a>                   <span class="st">`</span><span class="dt">Parameter Code</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-9"><a href="data.html#cb6-9"></a>                   <span class="st">`</span><span class="dt">Parameter Description</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-10"><a href="data.html#cb6-10"></a>                   <span class="st">`</span><span class="dt">Greater Than/Less Than</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-11"><a href="data.html#cb6-11"></a>                   <span class="dt">Value =</span> <span class="kw">col_double</span>(),</span>
<span id="cb6-12"><a href="data.html#cb6-12"></a>                   <span class="st">`</span><span class="dt">End Date</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_date</span>(<span class="dt">format =</span> <span class="st">&quot;%m/%d/%Y&quot;</span>),</span>
<span id="cb6-13"><a href="data.html#cb6-13"></a>                   <span class="st">`</span><span class="dt">End Time</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-14"><a href="data.html#cb6-14"></a>                   <span class="st">`</span><span class="dt">End Depth</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-15"><a href="data.html#cb6-15"></a>                   <span class="st">`</span><span class="dt">Start Date</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-16"><a href="data.html#cb6-16"></a>                   <span class="st">`</span><span class="dt">Start Time</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-17"><a href="data.html#cb6-17"></a>                   <span class="st">`</span><span class="dt">Start Depth</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-18"><a href="data.html#cb6-18"></a>                   <span class="st">`</span><span class="dt">Composite Category</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-19"><a href="data.html#cb6-19"></a>                   <span class="st">`</span><span class="dt">Composite Type</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_skip</span>(),</span>
<span id="cb6-20"><a href="data.html#cb6-20"></a>                   <span class="st">`</span><span class="dt">Submitting Entity</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-21"><a href="data.html#cb6-21"></a>                   <span class="st">`</span><span class="dt">Collecting Entity</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-22"><a href="data.html#cb6-22"></a>                   <span class="st">`</span><span class="dt">Monitoring Type</span><span class="st">`</span> =<span class="st"> </span><span class="kw">col_character</span>(),</span>
<span id="cb6-23"><a href="data.html#cb6-23"></a>                   <span class="dt">Comments =</span> <span class="kw">col_character</span>())</span>
<span id="cb6-24"><a href="data.html#cb6-24"></a>                 )</span>
<span id="cb6-25"><a href="data.html#cb6-25"></a></span>
<span id="cb6-26"><a href="data.html#cb6-26"></a>df</span></code></pre></div>
<pre><code>## # A tibble: 122 x 12
##    `RFA(Sample Set… Segment `Station ID` `Station Descri… `Parameter Code`
##    &lt;chr&gt;            &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;           
##  1 1549521          1501    12515        TRES PALACIOS C… 31701           
##  2 R201391          1501    12515        TRES PALACIOS C… 31701           
##  3 R212883          1501    12515        TRES PALACIOS C… 31701           
##  4 L080888          1501    12515        TRES PALACIOS C… 31701           
##  5 L083338          1501    12515        TRES PALACIOS C… 31701           
##  6 L086380          1501    12515        TRES PALACIOS C… 31701           
##  7 L086923          1501    12515        TRES PALACIOS C… 31701           
##  8 L087695          1501    12515        TRES PALACIOS C… 31701           
##  9 L092047          1501    12515        TRES PALACIOS C… 31701           
## 10 10231848         1501    12515        TRES PALACIOS C… 31701           
## # … with 112 more rows, and 7 more variables: `Parameter Description` &lt;chr&gt;,
## #   Value &lt;dbl&gt;, `End Date` &lt;date&gt;, `Submitting Entity` &lt;chr&gt;, `Collecting
## #   Entity` &lt;chr&gt;, `Monitoring Type` &lt;chr&gt;, Comments &lt;chr&gt;</code></pre>
<p>The read_delim and related functions will produce an object called a tibble. When you print a tibble to the console, it provides the column names, variable types, and an abbreviated snapshot of the first few rows of data.</p>
</div>
<div id="formatting-data" class="section level2">
<h2><span class="header-section-number">1.2</span> Formatting Data</h2>
<p>Most analysis and plotting functions in R prefer something called <em>tidy data</em>. The concept of tidy data can be difficult to grasp since we often don’t record data in a tidy format. Table <a href="#tab:wide-data"><strong>??</strong></a> is an example of how data is often recorded in a spreadsheet. Notice there is a row for each date, then columns that have values for each water quality parameter and flow.</p>
<table>
<caption><span id="tab:widedata">Table 1.1: </span>Example of wide data format</caption>
<thead>
<tr class="header">
<th align="left">Date</th>
<th align="right">Flow</th>
<th align="right">Nitrogen</th>
<th align="right">Phosphorus</th>
<th align="right">Ecoli</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2020-01-01</td>
<td align="right">130</td>
<td align="right">0.31</td>
<td align="right">0.03</td>
<td align="right">189</td>
</tr>
<tr class="even">
<td align="left">2020-01-16</td>
<td align="right">73</td>
<td align="right">0.14</td>
<td align="right">0.00</td>
<td align="right">146</td>
</tr>
<tr class="odd">
<td align="left">2020-01-31</td>
<td align="right">212</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">893</td>
</tr>
<tr class="even">
<td align="left">2020-02-15</td>
<td align="right">2259</td>
<td align="right">0.15</td>
<td align="right">0.02</td>
<td align="right">77</td>
</tr>
<tr class="odd">
<td align="left">2020-03-01</td>
<td align="right">122</td>
<td align="right">0.17</td>
<td align="right">0.01</td>
<td align="right">122</td>
</tr>
</tbody>
</table>
<p>Tidy data is also called long data. The goal is to get one observation per row and a column for every covariate. In this case, we can tidy the data into four columns: Date, Flow Value, Parameter Name, and Parameter Value (Table <a href="#tab:narrow-data"><strong>??</strong></a>. The observation of interest is the Parameter_Value which has a unique observation for each row. Date, Flow, and Parameter_name are not unique observations any longer.</p>
<pre><code>## # A tibble: 15 x 4
##    Date        Flow Parameter_Name Parameter_Value
##    &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;                    &lt;dbl&gt;
##  1 2020-01-01   130 Nitrogen                  0.31
##  2 2020-01-01   130 Phosphorus                0.03
##  3 2020-01-01   130 Ecoli                   189   
##  4 2020-01-16    73 Nitrogen                  0.14
##  5 2020-01-16    73 Phosphorus                0   
##  6 2020-01-16    73 Ecoli                   146   
##  7 2020-01-31   212 Nitrogen                  0.08
##  8 2020-01-31   212 Phosphorus                0.01
##  9 2020-01-31   212 Ecoli                   893   
## 10 2020-02-15  2259 Nitrogen                  0.15
## 11 2020-02-15  2259 Phosphorus                0.02
## 12 2020-02-15  2259 Ecoli                    77   
## 13 2020-03-01   122 Nitrogen                  0.17
## 14 2020-03-01   122 Phosphorus                0.01
## 15 2020-03-01   122 Ecoli                   122</code></pre>
<p><strong>Work through real world example</strong></p>
</div>
<div id="fed-data" class="section level2">
<h2><span class="header-section-number">1.3</span> USGS and EPA Data</h2>
<p>USGS provides R functions to retrieve and load streamflow and water quality data directly to R through the <code>dataRetrieval</code> package <span class="citation">(De Cicco et al. <a href="#ref-R-dataRetrieval" role="doc-biblioref">2018</a>)</span>.</p>
</div>
<div id="online-data-sources" class="section level2">
<h2><span class="header-section-number">1.4</span> Online Data Sources</h2>
<p>Use APIs (TWDB example)</p>
</div>
<div id="project-workflows" class="section level2">
<h2><span class="header-section-number">1.5</span> Project Workflows</h2>
<p>Discuss project structure, storing raw data seperately, using scripts to download and save data locally one time,</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-dataRetrieval">
<p>De Cicco, Laura A., David Lorenz, Robert M. Hirsch, and William Watkins. 2018. <em>DataRetrieval: R Packages for Discovering and Retrieving Water Data Available from U.s. Federal Hydrologic Web Services</em> (version 2.7.6). Reston, VA: U.S. Geological Survey; U.S. Geological Survey. <a href="https://doi.org/10.5066/P9X4L3GE">https://doi.org/10.5066/P9X4L3GE</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summarize-and-visualize-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
